<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的 AI 聚合站</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        .chat-box { border: 1px solid #ddd; padding: 1rem; height: 300px; overflow-y: scroll; margin-bottom: 1rem; border-radius: 8px; background: #f9f9f9; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:disabled { background: #ccc; }
        .msg { margin: 5px 0; padding: 8px; border-radius: 5px; }
        .user { background: #e3f2fd; text-align: right; }
        .ai { background: #fff; border: 1px solid #eee; }
    </style>
</head>
<body>
    <h1>AI 聚合中转站</h1>
    
    <div class="input-group">
        <input type="password" id="password" placeholder="请输入访问密码" style="width: 150px;">
        <select id="model">
            <option value="deepseek">DeepSeek V3</option>
            <option value="gemini">Gemini 1.5</option>
            <option value="chatgpt">ChatGPT 4o-mini</option>
        </select>
    </div>

    <div class="chat-box" id="chatBox">
        <div class="msg ai">你好！请先输入密码，然后选择模型开始聊天。</div>
    </div>

    <div class="input-group">
        <input type="text" id="userInput" placeholder="输入你的问题..." style="flex: 1;">
        <button onclick="sendMessage()" id="sendBtn">发送</button>
    </div>

    <script>
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const password = document.getElementById('password').value;
            const model = document.getElementById('model').value;
            const chatBox = document.getElementById('chatBox');
            const btn = document.getElementById('sendBtn');
            
            if (!input.value) return;
            if (!password) { alert('没密码怎么聊？'); return; }

            // 显示用户消息
            chatBox.innerHTML += `<div class="msg user">${input.value}</div>`;
            const userText = input.value;
            input.value = '';
            btn.disabled = true;
            btn.innerText = '思考中...';

            try {
                // 发送给你的 Vercel 后端
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: userText, 
                        modelType: model, 
                        password: password 
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    chatBox.innerHTML += `<div class="msg ai"><b>${model}:</b> ${data.reply}</div>`;
                } else {
                    chatBox.innerHTML += `<div class="msg ai" style="color:red">错误: ${data.error}</div>`;
                }
            } catch (err) {
                chatBox.innerHTML += `<div class="msg ai" style="color:red">网络错误</div>`;
            } finally {
                chatBox.scrollTop = chatBox.scrollHeight;
                btn.disabled = false;
                btn.innerText = '发送';
            }
        }
    </script>
</body>
</html>